
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>15. Python and Databases · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-styled-blockquotes/plugin-styled-blockquotes.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-githubcontributors/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="crditos.html" />
    
    
    <link rel="prev" href="14-objects.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="01-intro.html">
            
                <a href="01-intro.html">
            
                    
                    1. Starting the journey
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="02-variables.html">
            
                <a href="02-variables.html">
            
                    
                    2. Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="03-conditional.html">
            
                <a href="03-conditional.html">
            
                    
                    3. Conditionals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="04-functions.html">
            
                <a href="04-functions.html">
            
                    
                    4. Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="05-iterations.html">
            
                <a href="05-iterations.html">
            
                    
                    5. Iterations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="06-strings.html">
            
                <a href="06-strings.html">
            
                    
                    6. Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="07-files.html">
            
                <a href="07-files.html">
            
                    
                    7. Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="08-lists.html">
            
                <a href="08-lists.html">
            
                    
                    8. Lists
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="09-dictionaries.html">
            
                <a href="09-dictionaries.html">
            
                    
                    9. Dictionaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="10-tuples.html">
            
                <a href="10-tuples.html">
            
                    
                    10. Tuples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="11-regex.html">
            
                <a href="11-regex.html">
            
                    
                    11. Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="12-network.html">
            
                <a href="12-network.html">
            
                    
                    12. Networked Programs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="13-web.html">
            
                <a href="13-web.html">
            
                    
                    13. Python and Web Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="14-objects.html">
            
                <a href="14-objects.html">
            
                    
                    14. Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.15" data-path="15-database.html">
            
                <a href="15-database.html">
            
                    
                    15. Python and Databases
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="crditos.html">
            
                <a href="crditos.html">
            
                    
                    Créditos
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >15. Python and Databases</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="using-databases-and-sql">Using Databases and SQL </h1>
<h2 id="what-is-a-database">What is a database? </h2>
<p>A <strong>database</strong> is a file that is organized for storing data. Most databases are organized like a <a href="GLOSSARY.html#dictionary" class="glossary-term" title="A mapping from a set of keys to their corresponding values.">dictionary</a> in the sense that they map from keys to values. The biggest difference is that the database is on disk (or other permanent storage), so it persists after the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> ends. Because a database is stored on permanent storage, it can store far more data than a <a href="GLOSSARY.html#dictionary" class="glossary-term" title="A mapping from a set of keys to their corresponding values.">dictionary</a>, which is limited to the size of the memory in the computer.</p>
<p>Like a <a href="GLOSSARY.html#dictionary" class="glossary-term" title="A mapping from a set of keys to their corresponding values.">dictionary</a>, database software is designed to keep the inserting and accessing of data very fast, even for large amounts of data. Database software maintains its performance by building <strong>indexes</strong> as data is added to the database to allow the computer to jump quickly to a particular entry.</p>
<p>There are many different database systems which are used for a wide variety of purposes including: Oracle, MySQL, Microsoft SQL Server, PostgreSQL, and SQLite. We focus on SQLite in this book because it is a very common database and is already built into Python. SQLite is designed to be <strong>embedded</strong> into other applications to provide database support within the application. For example, the Firefox browser also uses the SQLite database internally as do many other products.</p>
<p><a href="http://sqlite.org/" target="_blank">http://sqlite.org/</a></p>
<p>SQLite is well suited to some of the data manipulation problems that we see in Informatics such as the Twitter spidering application that we describe in this chapter.</p>
<h2 id="database-concepts">Database concepts </h2>
<p>When you first look at a database it looks like a spreadsheet with multiple sheets. The primary data structures in a database are: <strong>tables</strong>, <strong>rows</strong>, and <strong>columns</strong>.</p>
<figure id="fig2.15.1"><img src="../img/databases.svg" alt="Relational databases"><figcaption>Imagen - Relational databases</figcaption></figure>
<p>In technical descriptions of relational databases the concepts of table, row, and column are more formally referred to as <strong><a href="GLOSSARY.html#relation" class="glossary-term" title="An area within a database that contains tuples and attributes. More typically called a &quot;table&quot;.">relation</a></strong>, <strong><a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a></strong>, and <strong><a href="GLOSSARY.html#attribute" class="glossary-term" title="One of the values within a tuple. More commonly called a &quot;column&quot; or &quot;field&quot;.">attribute</a></strong>, respectively. We will use the less formal terms in this chapter.</p>
<h2 id="database-browser-for-sqlite">Database Browser for SQLite </h2>
<p>While this chapter will focus on using Python to work with data in SQLite database files, many operations can be done more conveniently using software called the <strong><a href="GLOSSARY.html#database-browser" class="glossary-term" title="A piece of software that allows you to directly connect to a database and manipulate the database directly without writing a program.">Database Browser</a> for SQLite</strong> which is freely available from:</p>
<p><a href="http://sqlitebrowser.org/" target="_blank">http://sqlitebrowser.org/</a></p>
<p>Using the browser you can easily create tables, insert data, edit data, or run simple SQL queries on the data in the database.</p>
<p>In a sense, the <a href="GLOSSARY.html#database-browser" class="glossary-term" title="A piece of software that allows you to directly connect to a database and manipulate the database directly without writing a program.">database browser</a> is similar to a text editor when working with text files. When you want to do one or very few operations on a <a href="GLOSSARY.html#text-file" class="glossary-term" title="A sequence of characters stored in permanent storage like a hard drive.">text file</a>, you can just open it in a text editor and make the changes you want. When you have many changes that you need to do to a <a href="GLOSSARY.html#text-file" class="glossary-term" title="A sequence of characters stored in permanent storage like a hard drive.">text file</a>, often you will write a simple Python <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>. You will find the same pattern when working with databases. You will do simple operations in the database manager and more complex operations will be most conveniently done in Python.</p>
<h2 id="creating-a-database-table">Creating a database table </h2>
<p>Databases require more defined structure than Python lists or dictionaries<sup><a href="#fn_1" id="reffn_1">1</a></sup>.</p>
<p>When we create a database <strong>table</strong> we must tell the database in advance the names of each of the <strong>columns</strong> in the table and the <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of data which we are planning to store in each <strong>column</strong>. When the database software knows the <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of data in each column, it can choose the most efficient way to store and look up the data based on the <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of data.</p>
<p>You can look at the various data types supported by SQLite at the following url:</p>
<p><a href="http://www.sqlite.org/datatypes.html" target="_blank">http://www.sqlite.org/datatypes.html</a></p>
<p>Defining structure for your data up front may seem inconvenient at the beginning, but the payoff is fast access to your data even when the database contains a large amount of data.</p>
<p>The code to create a database file and a table named <code>Tracks</code> with two columns in the database is as follows:</p>
<iframe src="https://trinket.io/embed/python3/09d1152020" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>The <code>connect</code> operation makes a &quot;connection&quot; to the database stored in the file <code>music.sqlite3</code> in the current directory. If the file does not exist, it will be created. The reason this is called a &quot;connection&quot; is that sometimes the database is stored on a separate &quot;database server&quot; from the server on which we are running our application. In our simple examples the database will just be a local file in the same directory as the Python code we are running.</p>
<p>A <strong><a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a></strong> is like a file handle that we can use to perform operations on the data stored in the database. Calling <code>cursor()</code> is very similar conceptually to calling <code>open()</code> when dealing with text files.</p>
<figure id="fig2.15.2"><img src="../img/database-cursor.svg" alt="A Database Cursor"><figcaption>Imagen - A Database <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">Cursor</a></figcaption></figure>
<p>Once we have the <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a>, we can begin to execute commands on the contents of the database using the <code>execute()</code> <a href="GLOSSARY.html#method" class="glossary-term" title="A function that is contained within a class and the objects that are constructed from the class. Some object-oriented patterns use &apos;message&apos; instead of &apos;method&apos; to describe this concept.">method</a>.</p>
<p>Database commands are expressed in a special language that has been standardized across many different database vendors to allow us to learn a single database language. The database language is called <strong>Structured Query Language</strong> or <strong>SQL</strong> for short.</p>
<p><a href="http://en.wikipedia.org/wiki/SQL" target="_blank">http://en.wikipedia.org/wiki/SQL</a></p>
<p>In our example, we are executing two SQL commands in our database. As a convention, we will show the SQL keywords in uppercase and the parts of the command that we are adding (such as the table and column names) will be shown in lowercase.</p>
<p>The first SQL command removes the <code>Tracks</code> table from the database if it exists. This pattern is simply to allow us to run the same <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> to create the <code>Tracks</code> table over and over again without causing an error. Note that the <code>DROP TABLE</code> command deletes the table and all of its contents from the database (i.e., there is no &quot;undo&quot;).</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;DROP TABLE IF EXISTS Tracks &apos;</span>)
</code></pre>
<p>The second command creates a table named <code>Tracks</code> with a text column named <code>title</code> and an <a href="GLOSSARY.html#integer" class="glossary-term" title="A type that represents whole numbers.">integer</a> column named <code>plays</code>.</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;CREATE TABLE Tracks (title TEXT, plays INTEGER)&apos;</span>)
</code></pre>
<p>Now that we have created a table named <code>Tracks</code>, we can put some data into that table using the SQL <code>INSERT</code> operation. Again, we begin by making a connection to the database and obtaining the <code>cursor</code>. We can then execute SQL commands using the <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a>.</p>
<p>The SQL <code>INSERT</code> command indicates which table we are using and then defines a new row by listing the fields we want to include <code>(title, plays)</code> followed by the <code>VALUES</code> we want placed in the new row. We specify the values as question marks <code>(?, ?)</code> to indicate that the actual values are passed in as a <a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a> <code>( &apos;My Way&apos;, 15 )</code> as the second <a href="GLOSSARY.html#parameter" class="glossary-term" title="A name used inside a function to refer to the value passed as an argument.">parameter</a> to the <code>execute()</code> call.</p>
<iframe src="https://trinket.io/embed/python3/e665c26f67" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>First we <code>INSERT</code> two rows into our table and use <code>commit()</code> to force the data to be written to the database file.</p>
<figure id="fig2.15.3"><img src="../img/rows-in-table.svg" alt="Rows in a Table"><figcaption>Imagen - Rows in a Table</figcaption></figure>
<p>Then we use the <code>SELECT</code> command to retrieve the rows we just inserted from the table. On the <code>SELECT</code> command, we indicate which columns we would like <code>(title, plays)</code> and indicate which table we want to retrieve the data from. After we execute the <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>, the <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a> is something we can loop through in a <code>for</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>. For efficiency, the <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a> does not read all of the data from the database when we execute the <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>. Instead, the data is read on demand as we loop through the rows in the <code>for</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>.</p>
<p>The output of the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> is as follows:</p>
<pre><code class="lang-python">Tracks:
(<span class="hljs-string">&apos;Thunderstruck&apos;</span>, <span class="hljs-number">20</span>)
(<span class="hljs-string">&apos;My Way&apos;</span>, <span class="hljs-number">15</span>)
</code></pre>
<p>Our <code>for</code> loop finds two rows, and each row is a Python <a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a> with the first <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> as the <code>title</code> and the second <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> as the number of <code>plays</code>.</p>
<p><strong>Note: You may see strings starting with <code>u&apos;</code> in other books or on the Internet. This was an indication in Python 2 that the strings are </strong>Unicode<em> strings that are capable of storing non-Latin character sets. In Python 3, all strings are unicode strings by default.</em></p>
<p>At the very end of the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>, we execute an SQL command to <code>DELETE</code> the rows we have just created so we can run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> over and over. The <code>DELETE</code> command shows the use of a <code>WHERE</code> clause that allows us to express a selection criterion so that we can ask the database to apply the command to only the rows that match the criterion. In this example the criterion happens to apply to all the rows so we empty the table out so we can run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> repeatedly. After the <code>DELETE</code> is performed, we also call <code>commit()</code> to force the data to be removed from the database.</p>
<h2 id="structured-query-language-summary">Structured Query Language summary </h2>
<p>So far, we have been using the Structured Query Language in our Python examples and have covered many of the basics of the SQL commands. In this section, we look at the SQL language in particular and give an overview of SQL syntax.</p>
<p>Since there are so many different database vendors, the Structured Query Language (SQL) was standardized so we could communicate in a portable manner to database systems from multiple vendors.</p>
<p>A relational database is made up of tables, rows, and columns. The columns generally have a <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> such as text, numeric, or date data. When we create a table, we indicate the names and types of the columns:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Tracks (title <span class="hljs-built_in">TEXT</span>, plays <span class="hljs-built_in">INTEGER</span>)
</code></pre>
<p>To insert a row into a table, we use the SQL <code>INSERT</code> command:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Tracks (title, plays) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;My Way&apos;</span>, <span class="hljs-number">15</span>)
</code></pre>
<p>The <code>INSERT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> specifies the table name, then a <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of the fields/columns that you would like to set in the new row, and then the <a href="GLOSSARY.html#keyword" class="glossary-term" title="A reserved word that is used by the compiler to parse a program; you cannot use keywords like if, def, and while as variable names.">keyword</a> <code>VALUES</code> and a <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of corresponding values for each of the fields.</p>
<p>The SQL <code>SELECT</code> command is used to retrieve rows and columns from a database. The <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> lets you specify which columns you would like to retrieve as well as a <code>WHERE</code> clause to select which rows you would like to see. It also allows an optional <code>ORDER BY</code> clause to control the sorting of the returned rows.</p>
<pre><code class="lang-sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Tracks <span class="hljs-keyword">WHERE</span> title = <span class="hljs-string">&apos;My Way&apos;</span>
</code></pre>
<p>Using <code>*</code> indicates that you want the database to return all of the columns for each row that matches the <code>WHERE</code> clause.</p>
<p>Note, unlike in Python, in a SQL <code>WHERE</code> clause we use a single equal sign to indicate a test for equality rather than a double equal sign. Other logical operations allowed in a <code>WHERE</code> clause include <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code>, as well as <code>AND</code> and <code>OR</code> and parentheses to build your logical expressions.</p>
<p>You can request that the returned rows be sorted by one of the fields as follows:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">SELECT</span> title,plays <span class="hljs-keyword">FROM</span> Tracks <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> title
</code></pre>
<p>To remove a row, you need a <code>WHERE</code> clause on an SQL <code>DELETE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>. The <code>WHERE</code> clause determines which rows are to be deleted:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> Tracks <span class="hljs-keyword">WHERE</span> title = <span class="hljs-string">&apos;My Way&apos;</span>
</code></pre>
<p>It is possible to <code>UPDATE</code> a column or columns within one or more rows in a table using the SQL <code>UPDATE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> as follows:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">UPDATE</span> Tracks <span class="hljs-keyword">SET</span> plays = <span class="hljs-number">16</span> <span class="hljs-keyword">WHERE</span> title = <span class="hljs-string">&apos;My Way&apos;</span>
</code></pre>
<p>The <code>UPDATE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> specifies a table and then a <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of fields and values to change after the <code>SET</code> <a href="GLOSSARY.html#keyword" class="glossary-term" title="A reserved word that is used by the compiler to parse a program; you cannot use keywords like if, def, and while as variable names.">keyword</a> and then an optional <code>WHERE</code> clause to select the rows that are to be updated. A single <code>UPDATE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> will change all of the rows that match the <code>WHERE</code> clause. If a <code>WHERE</code> clause is not specified, it performs the <code>UPDATE</code> on all of the rows in the table.</p>
<p>These four basic SQL commands (INSERT, SELECT, UPDATE, and DELETE) allow the four basic operations needed to create and maintain data.</p>
<h2 id="spidering-twitter-using-a-database">Spidering Twitter using a database </h2>
<p>In this section, we will create a simple spidering <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> that will go through Twitter accounts and build a database of them. <strong>Note: Be very careful when running this <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>. You do not want to pull too much data or run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> for too long and end up having your Twitter access shut off.</strong></p>
<p>One of the problems of any kind of spidering <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> is that it needs to be able to be stopped and restarted many times and you do not want to lose the data that you have retrieved so far. You don&apos;t want to always restart your data retrieval at the very beginning so we want to store data as we retrieve it so our <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> can start back up and pick up where it left off.</p>
<p>We will start by retrieving one person&apos;s Twitter friends and their statuses, looping through the <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of friends, and adding each of the friends to a database to be retrieved in the future. After we process one person&apos;s Twitter friends, we check in our database and retrieve one of the friends of the friend. We do this over and over, picking an &quot;unvisited&quot; person, retrieving their friend <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a>, and adding friends we have not seen to our <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> for a future visit.</p>
<p>We also track how many times we have seen a particular friend in the database to get some sense of their &quot;popularity&quot;.</p>
<p>By storing our <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of known accounts and whether we have retrieved the account or not, and how popular the account is in a database on the disk of the computer, we can stop and restart our <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> as many times as we like.</p>
<p>This <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> is a bit complex. It is based on the code from the exercise earlier in the book that uses the Twitter <a href="GLOSSARY.html#api" class="glossary-term" title="Application Program Interface - A contract between applications that defines the patterns of interaction between two application components.">API</a>.</p>
<p>Here is the <a href="GLOSSARY.html#source-code" class="glossary-term" title="A program in a high-level language.">source code</a> for our Twitter spidering application:</p>
<iframe src="https://trinket.io/embed/python3/f9ee36fa1f" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>Our database is stored in the file <code>spider.sqlite3</code> and it has one table named <code>Twitter</code>. Each row in the <code>Twitter</code> table has a column for the account name, whether we have retrieved the friends of this account, and how many times this account has been &quot;friended&quot;.</p>
<p>In the main loop of the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>, we <a href="GLOSSARY.html#prompt" class="glossary-term" title="When a program displays a message and pauses for the user to type some input to the program.">prompt</a> the user for a Twitter account name or &quot;quit&quot; to exit the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>. If the user enters a Twitter account, we retrieve the <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of friends and statuses for that user and add each friend to the database if not already in the database. If the friend is already in the <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a>, we add 1 to the <code>friends</code> field in the row in the database.</p>
<p>If the user presses enter, we look in the database for the next Twitter account that we have not yet retrieved, retrieve the friends and statuses for that account, add them to the database or update them, and increase their <code>friends</code> count.</p>
<p>Once we retrieve the <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of friends and statuses, we loop through all of the <code>user</code> items in the returned <a href="GLOSSARY.html#json" class="glossary-term" title="JavaScript Object Notation. A format that allows for the markup of structured data based on the syntax of JavaScript Objects.">JSON</a> and retrieve the <code>screen_name</code> for each user. Then we use the <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> to see if we already have stored this particular <code>screen_name</code> in the database and retrieve the friend count (<code>friends</code>) if the record exists.</p>
<pre><code class="lang-python">countnew = <span class="hljs-number">0</span>
countold = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> js[<span class="hljs-string">&apos;users&apos;</span>] :
    friend = u[<span class="hljs-string">&apos;screen_name&apos;</span>]
    <span class="hljs-keyword">print</span> friend
    cur.execute(<span class="hljs-string">&apos;SELECT friends FROM Twitter WHERE name = ? LIMIT 1&apos;</span>,
        (friend, ) )
    <span class="hljs-keyword">try</span>:
        count = cur.fetchone()[<span class="hljs-number">0</span>]
        cur.execute(<span class="hljs-string">&apos;UPDATE Twitter SET friends = ? WHERE name = ?&apos;</span>,
            (count+<span class="hljs-number">1</span>, friend) )
        countold = countold + <span class="hljs-number">1</span>
    <span class="hljs-keyword">except</span>:
        cur.execute(<span class="hljs-string">&apos;&apos;&apos;INSERT INTO Twitter (name, retrieved, friends)
            VALUES ( ?, 0, 1 )&apos;&apos;&apos;</span>, ( friend, ) )
        countnew = countnew + <span class="hljs-number">1</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">&apos;New accounts=&apos;</span>,countnew,<span class="hljs-string">&apos; revisited=&apos;</span>,countold
conn.commit()
</code></pre>
<p>Once the <a href="GLOSSARY.html#cursor" class="glossary-term" title="A cursor allows you to execute SQL commands in a database and retrieve data from the database. A cursor is similar to a socket or file handle for network connections and files, respectively.">cursor</a> executes the <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>, we must retrieve the rows. We could do this with a <code>for</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>, but since we are only retrieving one row (<code>LIMIT 1</code>), we can use the <code>fetchone()</code> <a href="GLOSSARY.html#method" class="glossary-term" title="A function that is contained within a class and the objects that are constructed from the class. Some object-oriented patterns use &apos;message&apos; instead of &apos;method&apos; to describe this concept.">method</a> to fetch the first (and only) row that is the result of the <code>SELECT</code> operation. Since <code>fetchone()</code> returns the row as a <strong><a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a></strong> (even though there is only one field), we take the first <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> from the <a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a> to get the current friend count into the <a href="GLOSSARY.html#variable" class="glossary-term" title="A name that refers to a value.">variable</a> <code>count</code>.</p>
<p>If this retrieval is successful, we use the SQL <code>UPDATE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> with a <code>WHERE</code> clause to add 1 to the <code>friends</code> column for the row that matches the friend&apos;s account. Notice that there are two placeholders (i.e., question marks) in the SQL, and the second <a href="GLOSSARY.html#parameter" class="glossary-term" title="A name used inside a function to refer to the value passed as an argument.">parameter</a> to the <code>execute()</code> is a two-<a href="GLOSSARY.html#element" class="glossary-term" title="One of the values in a list (or other sequence); also called items.">element</a> <a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a> that holds the values to be substituted into the SQL in place of the question marks.</p>
<p>If the code in the <code>try</code> block fails, it is probably because no record matched the <code>WHERE name = ?</code> clause on the SELECT <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>. So in the <code>except</code> block, we use the SQL <code>INSERT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> to add the friend&apos;s <code>screen_name</code> to the table with an indication that we have not yet retrieved the <code>screen_name</code> and set the friend count to zero.</p>
<p>So the first time the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> runs and we enter a Twitter account, the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> runs as follows:</p>
<pre><code class="lang-python">Enter a Twitter account, <span class="hljs-keyword">or</span> quit: drchuck
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">20</span>  revisited= <span class="hljs-number">0</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit: quit
</code></pre>
<p>Since this is the first time we have run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>, the database is empty and we create the database in the file <code>spider.sqlite3</code> and add a table named <code>Twitter</code> to the database. Then we retrieve some friends and add them all to the database since the database is empty.</p>
<p>At this point, we might want to write a simple database dumper to take a look at what is in our <code>spider.sqlite3</code> file:</p>
<iframe src="https://trinket.io/embed/python3/e986702fd6" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>This <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> simply opens the database and selects all of the columns of all of the rows in the table <code>Twitter</code>, then loops through the rows and prints out each row.</p>
<p>If we run this <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> after the first execution of our Twitter <a href="GLOSSARY.html#spider" class="glossary-term" title="The act of a web search engine retrieving a page and then all the pages linked from a page and so on until they have nearly all of the pages on the Internet which they use to build their search index.">spider</a> above, its output will be as follows:</p>
<pre><code class="lang-python">(<span class="hljs-string">&apos;opencontent&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;lhawthorn&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;steve_coppin&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;davidkocher&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;hrheingold&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
...
<span class="hljs-number">20</span> rows.
</code></pre>
<p>We see one row for each <code>screen_name</code>, that we have not retrieved the data for that <code>screen_name</code>, and everyone in the database has one friend.</p>
<p>Now our database reflects the retrieval of the friends of our first Twitter account (<strong>drchuck</strong>). We can run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> again and tell it to retrieve the friends of the next &quot;unprocessed&quot; account by simply pressing enter instead of a Twitter account as follows:</p>
<pre><code class="lang-python">Enter a Twitter account, <span class="hljs-keyword">or</span> quit:
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">18</span>  revisited= <span class="hljs-number">2</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit:
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">17</span>  revisited= <span class="hljs-number">3</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit: quit
</code></pre>
<p>Since we pressed enter (i.e., we did not specify a Twitter account), the following code is executed:</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> ( len(acct) &lt; <span class="hljs-number">1</span> ) :
    cur.execute(<span class="hljs-string">&apos;SELECT name FROM Twitter WHERE retrieved = 0 LIMIT 1&apos;</span>)
    <span class="hljs-keyword">try</span>:
        acct = cur.fetchone()[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">print</span> <span class="hljs-string">&apos;No unretrieved twitter accounts found&apos;</span>
        <span class="hljs-keyword">continue</span>
</code></pre>
<p>We use the SQL <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> to retrieve the name of the first (<code>LIMIT 1</code>) user who still has their &quot;have we retrieved this user&quot; <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> set to zero. We also use the <code>fetchone()[0]</code> pattern within a try/except block to either extract a <code>screen_name</code> from the retrieved data or put out an error message and loop back up.</p>
<p>If we successfully retrieved an unprocessed <code>screen_name</code>, we retrieve their data as follows:</p>
<pre><code class="lang-python">url = twurl.augment(TWITTER_URL, {<span class="hljs-string">&apos;screen_name&apos;</span>: acct, <span class="hljs-string">&apos;count&apos;</span>: <span class="hljs-string">&apos;20&apos;</span>})
print(<span class="hljs-string">&apos;Retrieving&apos;</span>)
url connection = urllib.urlopen(url)
data = connection.read()
js = json.loads(data)
cur.execute(<span class="hljs-string">&apos;UPDATE Twitter SET retrieved = 1 WHERE nombre =?&apos;</span>, (acct,))
</code></pre>
<p>Once we retrieve the data successfully, we use the <code>UPDATE</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> to set the <code>retrieved</code> column to 1 to indicate that we have completed the retrieval of the friends of this account. This keeps us from retrieving the same data over and over and keeps us progressing forward through the network of Twitter friends.</p>
<p>If we run the friend <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> and press enter twice to retrieve the next unvisited friend&apos;s friends, then run the dumping <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>, it will give us the following output:</p>
<pre><code class="lang-python">(<span class="hljs-string">&apos;opencontent&apos;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;lhawthorn&apos;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;steve_coppin&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;davidkocher&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;hrheingold&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
...
(<span class="hljs-string">&apos;cnxorg&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
(<span class="hljs-string">&apos;knoop&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
(<span class="hljs-string">&apos;kthanos&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
(<span class="hljs-string">&apos;LectureTools&apos;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
...
<span class="hljs-number">55</span> rows.
</code></pre>
<p>We can see that we have properly recorded that we have visited <code>lhawthorn</code> and <code>opencontent</code>. Also the accounts <code>cnxorg</code> and <code>kthanos</code> already have two followers. Since we now have retrieved the friends of three people (<code>drchuck</code>, <code>opencontent</code>, and <code>lhawthorn</code>) our table has 55 rows of friends to retrieve.</p>
<p>Each time we run the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> and press enter it will pick the next unvisited account (e.g., the next account will be <code>steve_coppin</code>), retrieve their friends, mark them as retrieved, and for each of the friends of <code>steve_coppin</code> either add them to the end of the database or update their friend count if they are already in the database.</p>
<p>Since the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>&apos;s data is all stored on disk in a database, the spidering activity can be suspended and resumed as many times as you like with no loss of data.</p>
<h2 id="basic-data-modeling">Basic data modeling </h2>
<p>The real power of a relational database is when we create multiple tables and make links between those tables. The act of deciding how to break up your application data into multiple tables and establishing the relationships between the tables is called <strong>data modeling</strong>. The design document that shows the tables and their relationships is called a <strong>data model</strong>.</p>
<p>Data modeling is a relatively sophisticated skill and we will only introduce the most basic concepts of relational data modeling in this section. For more detail on data modeling you can start with:</p>
<p><a href="http://en.wikipedia.org/wiki/Relational_model" target="_blank">http://en.wikipedia.org/wiki/Relational_model</a></p>
<p>Let&apos;s say for our Twitter <a href="GLOSSARY.html#spider" class="glossary-term" title="The act of a web search engine retrieving a page and then all the pages linked from a page and so on until they have nearly all of the pages on the Internet which they use to build their search index.">spider</a> application, instead of just counting a person&apos;s friends, we wanted to keep a <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of all of the incoming relationships so we could find a <a href="GLOSSARY.html#list" class="glossary-term" title="A sequence of values.">list</a> of everyone who is following a particular account.</p>
<p>Since everyone will potentially have many accounts that follow them, we cannot simply add a single column to our <code>Twitter</code> table. So we create a new table that keeps track of pairs of friends. The following is a simple way of making such a table:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Pals (from_friend <span class="hljs-built_in">TEXT</span>, to_friend <span class="hljs-built_in">TEXT</span>)
</code></pre>
<p>Each time we encounter a person who <code>drchuck</code> is following, we would insert a row of the form:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Pals (from_friend,to_friend) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&apos;drchuck&apos;</span>, <span class="hljs-string">&apos;lhawthorn&apos;</span>)
</code></pre>
<p>As we are processing the 20 friends from the <code>drchuck</code> Twitter feed, we will insert 20 records with &quot;drchuck&quot; as the first <a href="GLOSSARY.html#parameter" class="glossary-term" title="A name used inside a function to refer to the value passed as an argument.">parameter</a> so we will end up duplicating the <a href="GLOSSARY.html#string" class="glossary-term" title="A type that represents sequences of characters.">string</a> many times in the database.</p>
<p>This duplication of <a href="GLOSSARY.html#string" class="glossary-term" title="A type that represents sequences of characters.">string</a> data violates one of the best practices for <strong>database <a href="GLOSSARY.html#normalization" class="glossary-term" title="Designing a data model so that no data is replicated. We store each item of data at one place in the database and reference it elsewhere using a foreign key.">normalization</a></strong> which basically states that we should never put the same <a href="GLOSSARY.html#string" class="glossary-term" title="A type that represents sequences of characters.">string</a> data in the database more than once. If we need the data more than once, we create a numeric <strong><a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a></strong> for the data and <a href="GLOSSARY.html#reference" class="glossary-term" title="The association between a variable and its value.">reference</a> the actual data using this <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a>.</p>
<p>In practical terms, a <a href="GLOSSARY.html#string" class="glossary-term" title="A type that represents sequences of characters.">string</a> takes up a lot more space than an <a href="GLOSSARY.html#integer" class="glossary-term" title="A type that represents whole numbers.">integer</a> on the disk and in the memory of our computer, and takes more processor time to compare and sort. If we only have a few hundred entries, the storage and processor time hardly matters. But if we have a million people in our database and a possibility of 100 million friend links, it is important to be able to scan data as quickly as possible.</p>
<p>We will store our Twitter accounts in a table named <code>People</code> instead of the <code>Twitter</code> table used in the previous example. The <code>People</code> table has an additional column to store the numeric <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> associated with the row for this Twitter user. SQLite has a feature that automatically adds the <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for any row we insert into a table using a special <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of data column (<code>INTEGER PRIMARY KEY</code>).</p>
<p>We can create the <code>People</code> table with this additional <code>id</code> column as follows:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> People
    (<span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span>, <span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">UNIQUE</span>, retrieved <span class="hljs-built_in">INTEGER</span>)
</code></pre>
<p>Notice that we are no longer maintaining a friend count in each row of the <code>People</code> table. When we select <code>INTEGER PRIMARY KEY</code> as the <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of our <code>id</code> column, we are indicating that we would like SQLite to manage this column and assign a unique numeric <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> to each row we insert automatically. We also add the <a href="GLOSSARY.html#keyword" class="glossary-term" title="A reserved word that is used by the compiler to parse a program; you cannot use keywords like if, def, and while as variable names.">keyword</a> <code>UNIQUE</code> to indicate that we will not allow SQLite to insert two rows with the same <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for <code>name</code>.</p>
<p>Now instead of creating the table <code>Pals</code> above, we create a table called <code>Follows</code> with two <a href="GLOSSARY.html#integer" class="glossary-term" title="A type that represents whole numbers.">integer</a> columns <code>from_id</code> and <code>to_id</code> and a <a href="GLOSSARY.html#constraint" class="glossary-term" title="When we tell the database to enforce a rule on a field or a row in a table. A common constraint is to insist that there can be no duplicate values in a particular field (i.e., all the values must be unique).">constraint</a> on the table that the <strong>combination</strong> of <code>from_id</code> and <code>to_id</code> must be unique in this table (i.e., we cannot insert duplicate rows) in our database.</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">Follows</span>
    (from_id <span class="hljs-built_in">INTEGER</span>, to_id <span class="hljs-built_in">INTEGER</span>, <span class="hljs-keyword">UNIQUE</span>(from_id, to_id) )
</code></pre>
<p>When we add <code>UNIQUE</code> clauses to our tables, we are communicating a set of rules that we are asking the database to enforce when we attempt to insert records. We are creating these rules as a convenience in our programs, as we will see in a moment. The rules both keep us from making mistakes and make it simpler to write some of our code.</p>
<p>In essence, in creating this <code>Follows</code> table, we are modelling a &quot;relationship&quot; where one person &quot;follows&quot; someone else and representing it with a pair of numbers indicating that (a) the people are connected and (b) the direction of the relationship.</p>
<figure id="fig2.15.4"><img src="img/relatinos-db.png" alt="Relationships Between Tables"><figcaption>Imagen - Relationships Between Tables</figcaption></figure>
<h2 id="programming-with-multiple-tables">Programming with multiple tables </h2>
<p>We will now redo the Twitter <a href="GLOSSARY.html#spider" class="glossary-term" title="The act of a web search engine retrieving a page and then all the pages linked from a page and so on until they have nearly all of the pages on the Internet which they use to build their search index.">spider</a> <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> using two tables, the primary keys, and the <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> references as described above. Here is the code for the new version of the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>:</p>
<iframe src="https://trinket.io/embed/python3/88efa27a18" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>This <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> is starting to get a bit complicated, but it illustrates the patterns that we need to use when we are using <a href="GLOSSARY.html#integer" class="glossary-term" title="A type that represents whole numbers.">integer</a> keys to link tables. The basic patterns are:</p>
<ol>
<li>Create tables with primary keys and constraints.</li>
<li>When we have a logical <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> for a person (i.e., account name) and we need the <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for the person, depending on whether or not the person is already in the <code>People</code> table we either need to: (1) look up the person in the <code>People</code> table and retrieve the <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for the person or (2) add the person to the <code>People</code> table and get the <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for the newly added row.</li>
<li>Insert the row that captures the &quot;follows&quot; relationship.</li>
</ol>
<p>We will cover each of these in turn.</p>
<h3 id="constraints-in-database-tables">Constraints in database tables </h3>
<p>As we design our table structures, we can tell the database system that we would like it to enforce a few rules on us. These rules help us from making mistakes and introducing incorrect data into out tables. When we create our tables:</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;&apos;&apos;CREATE TABLE IF NOT EXISTS People
    (id INTEGER PRIMARY KEY, name TEXT UNIQUE, retrieved INTEGER)&apos;&apos;&apos;</span>)
cur.execute(<span class="hljs-string">&apos;&apos;&apos;CREATE TABLE IF NOT EXISTS Follows
    (from_id INTEGER, to_id INTEGER, UNIQUE(from_id, to_id))&apos;&apos;&apos;</span>)
</code></pre>
<p>We indicate that the <code>name</code> column in the <code>People</code> table must be <code>UNIQUE</code>. We also indicate that the combination of the two numbers in each row of the <code>Follows</code> table must be unique. These constraints keep us from making mistakes such as adding the same relationship more than once.</p>
<p>We can take advantage of these constraints in the following code:</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;&apos;&apos;INSERT OR IGNORE INTO People (name, retrieved)
    VALUES ( ?, 0)&apos;&apos;&apos;</span>, ( friend, ) )
</code></pre>
<p>We add the <code>OR IGNORE</code> clause to our <code>INSERT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a> to indicate that if this particular <code>INSERT</code> would cause a violation of the &quot;<code>name</code> must be unique&quot; rule, the database system is allowed to ignore the <code>INSERT</code>. We are using the database <a href="GLOSSARY.html#constraint" class="glossary-term" title="When we tell the database to enforce a rule on a field or a row in a table. A common constraint is to insist that there can be no duplicate values in a particular field (i.e., all the values must be unique).">constraint</a> as a safety net to make sure we don&apos;t inadvertently do something incorrect.</p>
<p>Similarly, the following code ensures that we don&apos;t add the exact same <code>Follows</code> relationship twice.</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;&apos;&apos;INSERT OR IGNORE INTO Follows
    (from_id, to_id) VALUES (?, ?)&apos;&apos;&apos;</span>, (id, friend_id) )
</code></pre>
<p>Again, we simply tell the database to ignore our attempted <code>INSERT</code> if it would violate the uniqueness <a href="GLOSSARY.html#constraint" class="glossary-term" title="When we tell the database to enforce a rule on a field or a row in a table. A common constraint is to insist that there can be no duplicate values in a particular field (i.e., all the values must be unique).">constraint</a> that we specified for the <code>Follows</code> rows.</p>
<h3 id="retrieve-andor-insert-a-record">Retrieve and/or insert a record </h3>
<p>When we <a href="GLOSSARY.html#prompt" class="glossary-term" title="When a program displays a message and pauses for the user to type some input to the program.">prompt</a> the user for a Twitter account, if the account exists, we must look up its <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a>. If the account does not yet exist in the <code>People</code> table, we must insert the record and get the <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> from the inserted row.</p>
<p>This is a very common pattern and is done twice in the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> above. This code shows how we look up the <code>id</code> for a friend&apos;s account when we have extracted a <code>screen_name</code> from a <code>user</code> node in the retrieved Twitter <a href="GLOSSARY.html#json" class="glossary-term" title="JavaScript Object Notation. A format that allows for the markup of structured data based on the syntax of JavaScript Objects.">JSON</a>.</p>
<p>Since over time it will be increasingly likely that the account will already be in the database, we first check to see if the <code>People</code> record exists using a <code>SELECT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>.</p>
<p>If all goes well<sup><a href="#fn_2" id="reffn_2">2</a></sup> inside the <code>try</code> section, we retrieve the record using <code>fetchone()</code> and then retrieve the first (and only) <a href="GLOSSARY.html#element" class="glossary-term" title="One of the values in a list (or other sequence); also called items.">element</a> of the returned <a href="GLOSSARY.html#tuple" class="glossary-term" title="A single entry in a database table that is a set of attributes. More typically called &quot;row&quot;.">tuple</a> and store it in <code>friend_id</code>.</p>
<p>If the <code>SELECT</code> fails, the <code>fetchone()[0]</code> code will fail and control will transfer into the <code>except</code> section.</p>
<pre><code class="lang-python">    friend = u[<span class="hljs-string">&apos;screen_name&apos;</span>]
    cur.execute(<span class="hljs-string">&apos;SELECT id FROM People WHERE name = ? LIMIT 1&apos;</span>,
        (friend, ) )
    <span class="hljs-keyword">try</span>:
        friend_id = cur.fetchone()[<span class="hljs-number">0</span>]
        countold = countold + <span class="hljs-number">1</span>
    <span class="hljs-keyword">except</span>:
        cur.execute(<span class="hljs-string">&apos;&apos;&apos;INSERT OR IGNORE INTO People (name, retrieved)
            VALUES ( ?, 0)&apos;&apos;&apos;</span>, ( friend, ) )
        conn.commit()
        <span class="hljs-keyword">if</span> cur.rowcount != <span class="hljs-number">1</span> :
            <span class="hljs-keyword">print</span> <span class="hljs-string">&apos;Error inserting account:&apos;</span>,friend
            <span class="hljs-keyword">continue</span>
        friend_id = cur.lastrowid
        countnew = countnew + <span class="hljs-number">1</span>
</code></pre>
<p>If we end up in the <code>except</code> code, it simply means that the row was not found, so we must insert the row. We use <code>INSERT OR IGNORE</code> just to avoid errors and then call <code>commit()</code> to force the database to really be updated. After the write is done, we can check the <code>cur.rowcount</code> to see how many rows were affected. Since we are attempting to insert a single row, if the number of affected rows is something other than 1, it is an error.</p>
<p>If the <code>INSERT</code> is successful, we can look at <code>cur.lastrowid</code> to find out what <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> the database assigned to the <code>id</code> column in our newly created row.</p>
<h3 id="storing-the-friend-relationship">Storing the friend relationship </h3>
<p>Once we know the <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> for both the Twitter user and the friend in the <a href="GLOSSARY.html#json" class="glossary-term" title="JavaScript Object Notation. A format that allows for the markup of structured data based on the syntax of JavaScript Objects.">JSON</a>, it is a simple matter to insert the two numbers into the <code>Follows</code> table with the following code:</p>
<pre><code class="lang-python">cur.execute(<span class="hljs-string">&apos;INSERT OR IGNORE INTO Follows (from_id, to_id) VALUES (?, ?)&apos;</span>,
    (id, friend_id) )
</code></pre>
<p>Notice that we let the database take care of keeping us from &quot;double-inserting&quot; a relationship by creating the table with a uniqueness <a href="GLOSSARY.html#constraint" class="glossary-term" title="When we tell the database to enforce a rule on a field or a row in a table. A common constraint is to insist that there can be no duplicate values in a particular field (i.e., all the values must be unique).">constraint</a> and then adding <code>OR IGNORE</code> to our <code>INSERT</code> <a href="GLOSSARY.html#statement" class="glossary-term" title="A section of code that represents a command or action. So far, the statements we have seen are assignments and print expression statement.">statement</a>.</p>
<p>Here is a sample execution of this <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>:</p>
<pre><code class="lang-python">Enter a Twitter account, <span class="hljs-keyword">or</span> quit:
No unretrieved Twitter accounts found
Enter a Twitter account, <span class="hljs-keyword">or</span> quit: drchuck
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">20</span>  revisited= <span class="hljs-number">0</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit:
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">17</span>  revisited= <span class="hljs-number">3</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit:
Retrieving http://api.twitter.com/<span class="hljs-number">1.1</span>/friends ...
New accounts= <span class="hljs-number">17</span>  revisited= <span class="hljs-number">3</span>
Enter a Twitter account, <span class="hljs-keyword">or</span> quit: quit
</code></pre>
<p>We started with the <code>drchuck</code> account and then let the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> automatically pick the next two accounts to retrieve and add to our database.</p>
<p>The following is the first few rows in the <code>People</code> and <code>Follows</code> tables after this run is completed:</p>
<pre><code class="lang-python">People:
(<span class="hljs-number">1</span>, <span class="hljs-string">&apos;drchuck&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;opencontent&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">3</span>, <span class="hljs-string">&apos;lhawthorn&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;steve_coppin&apos;</span>, <span class="hljs-number">0</span>)
(<span class="hljs-number">5</span>, <span class="hljs-string">&apos;davidkocher&apos;</span>, <span class="hljs-number">0</span>)
<span class="hljs-number">55</span> rows.
Follows:
(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)
<span class="hljs-number">60</span> rows.
</code></pre>
<p>You can see the <code>id</code>, <code>name</code>, and <code>visited</code> fields in the <code>People</code> table and you see the numbers of both ends of the relationship in the <code>Follows</code> table. In the <code>People</code> table, we can see that the first three people have been visited and their data has been retrieved. The data in the <code>Follows</code> table indicates that <code>drchuck</code> (user 1) is a friend to all of the people shown in the first five rows. This makes sense because the first data we retrieved and stored was the Twitter friends of <code>drchuck</code>. If you were to print more rows from the <code>Follows</code> table, you would see the friends of users 2 and 3 as well.</p>
<h2 id="three-kinds-of-keys">Three kinds of keys </h2>
<p>TODO go on here
Now that we have started building a data model putting our data into multiple linked tables and linking the rows in those tables using <strong>keys</strong>, we need to look at some terminology around keys. There are generally three kinds of keys used in a database model.</p>
<ul>
<li>A <strong>logical <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a></strong> is a <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> that the &quot;real world&quot; might use to look up a row. In our example data model, the <code>name</code> field is a logical <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a>. It is the screen name for the user and we indeed look up a user&apos;s row several times in the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> using the <code>name</code> field. You will often find that it makes sense to add a <code>UNIQUE</code> <a href="GLOSSARY.html#constraint" class="glossary-term" title="When we tell the database to enforce a rule on a field or a row in a table. A common constraint is to insist that there can be no duplicate values in a particular field (i.e., all the values must be unique).">constraint</a> to a logical <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a>. Since the logical <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> is how we look up a row from the outside world, it makes little sense to allow multiple rows with the same <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> in the table.</li>
<li>A <strong>primary <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a></strong> is usually a number that is assigned automatically by the database. It generally has no meaning outside the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> and is only used to link rows from different tables together. When we want to look up a row in a table, usually searching for the row using the primary <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> is the fastest way to find the row. Since primary keys are <a href="GLOSSARY.html#integer" class="glossary-term" title="A type that represents whole numbers.">integer</a> numbers, they take up very little storage and can be compared or sorted very quickly. In our data model, the <code>id</code> field is an example of a primary <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a>.</li>
<li>A <strong>foreign <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a></strong> is usually a number that points to the primary <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> of an associated row in a different table. An example of a foreign <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> in our data model is the <code>from_id</code>.</li>
</ul>
<p>We are using a naming convention of always calling the primary <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a> field name <code>id</code> and appending the suffix <code>_id</code> to any field name that is a foreign <a href="GLOSSARY.html#key" class="glossary-term" title="An object that appears in a dictionary as the first part of a key-value pair.">key</a>.</p>
<h2 id="using-join-to-retrieve-data">Using JOIN to retrieve data </h2>
<p>Now that we have followed the rules of database <a href="GLOSSARY.html#normalization" class="glossary-term" title="Designing a data model so that no data is replicated. We store each item of data at one place in the database and reference it elsewhere using a foreign key.">normalization</a> and have data separated into two tables, linked together using primary and foreign keys, we need to be able to build a <code>SELECT</code> that reassembles the data across the tables.</p>
<p>SQL uses the <code>JOIN</code> clause to reconnect these tables. In the <code>JOIN</code> clause you specify the fields that are used to reconnect the rows between the tables.</p>
<p>The following is an example of a <code>SELECT</code> with a <code>JOIN</code> clause:</p>
<pre><code class="lang-python">SELECT * FROM Follows JOIN People
    ON Follows.from_id = People.id WHERE People.id = <span class="hljs-number">1</span>
</code></pre>
<p>The <code>JOIN</code> clause indicates that the fields we are selecting cross both the <code>Follows</code> and <code>People</code> tables. The <code>ON</code> clause indicates how the two tables are to be joined: Take the rows from <code>Follows</code> and append the row from <code>People</code> where the field <code>from_id</code> in <code>Follows</code> is the same the <code>id</code> <a href="GLOSSARY.html#value" class="glossary-term" title="An object that appears in a dictionary as the second part of a key-value pair. This is more specific than our previous use of the word &quot;value&quot;.">value</a> in the <code>People</code> table.</p>
<figure id="fig2.15.5"><img src="../img/connecting-tables.svg" alt="Connecting Tables Using JOIN"><figcaption>Imagen - Connecting Tables Using JOIN</figcaption></figure>
<p>The result of the JOIN is to create extra-long &quot;metarows&quot; which have both the fields from <code>People</code> and the matching fields from <code>Follows</code>. Where there is more than one match between the <code>id</code> field from <code>People</code> and the <code>from_id</code> from <code>People</code>, then JOIN creates a metarow for <strong>each</strong> of the matching pairs of rows, duplicating data as needed.</p>
<p>The following code demonstrates the data that we will have in the database after the multi-table Twitter <a href="GLOSSARY.html#spider" class="glossary-term" title="The act of a web search engine retrieving a page and then all the pages linked from a page and so on until they have nearly all of the pages on the Internet which they use to build their search index.">spider</a> <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> (above) has been run several times.</p>
<iframe src="https://trinket.io/embed/python3/8f92ad783f" width="100%" height="356" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>

<p>In this <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>, we first dump out the <code>People</code> and <code>Follows</code> and then dump out a subset of the data in the tables joined together.</p>
<p>Here is the output of the <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a>:</p>
<pre><code class="lang-python">python twjoin.py
People:
(<span class="hljs-number">1</span>, <span class="hljs-string">&apos;drchuck&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;opencontent&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">3</span>, <span class="hljs-string">&apos;lhawthorn&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;steve_coppin&apos;</span>, <span class="hljs-number">0</span>)
(<span class="hljs-number">5</span>, <span class="hljs-string">&apos;davidkocher&apos;</span>, <span class="hljs-number">0</span>)
<span class="hljs-number">55</span> rows.
Follows:
(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)
<span class="hljs-number">60</span> rows.
Connections <span class="hljs-keyword">for</span> id=<span class="hljs-number">2</span>:
(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&apos;drchuck&apos;</span>, <span class="hljs-number">1</span>)
(<span class="hljs-number">2</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-string">&apos;cnxorg&apos;</span>, <span class="hljs-number">0</span>)
(<span class="hljs-number">2</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&apos;kthanos&apos;</span>, <span class="hljs-number">0</span>)
(<span class="hljs-number">2</span>, <span class="hljs-number">102</span>, <span class="hljs-number">102</span>, <span class="hljs-string">&apos;SomethingGirl&apos;</span>, <span class="hljs-number">0</span>)
(<span class="hljs-number">2</span>, <span class="hljs-number">103</span>, <span class="hljs-number">103</span>, <span class="hljs-string">&apos;ja_Pac&apos;</span>, <span class="hljs-number">0</span>)
<span class="hljs-number">20</span> rows.
</code></pre>
<p>You see the columns from the <code>People</code> and <code>Follows</code> tables and the last set of rows is the result of the <code>SELECT</code> with the <code>JOIN</code> clause.</p>
<p>In the last select, we are looking for accounts that are friends of &quot;opencontent&quot; (i.e., <code>People.id=2</code>).</p>
<p>In each of the &quot;metarows&quot; in the last select, the first two columns are from the <code>Follows</code> table followed by columns three through five from the <code>People</code> table. You can also see that the second column (<code>Follows.to_id</code>) matches the third column (<code>People.id</code>) in each of the joined-up &quot;metarows&quot;.</p>
<h2 id="summary">Summary </h2>
<p>This chapter has covered a lot of ground to give you an overview of the basics of using a database in Python. It is more complicated to write the code to use a database to store data than Python dictionaries or flat files so there is little reason to use a database unless your application truly needs the capabilities of a database. The situations where a database can be quite useful are: (1) when your application needs to make small many random updates within a large data set, (2) when your data is so large it cannot fit in a <a href="GLOSSARY.html#dictionary" class="glossary-term" title="A mapping from a set of keys to their corresponding values.">dictionary</a> and you need to look up information repeatedly, or (3) when you have a long-running process that you want to be able to stop and restart and retain the data from one run to the next.</p>
<p>You can build a simple database with a single table to suit many application needs, but most problems will require several tables and links/relationships between rows in different tables. When you start making links between tables, it is important to do some thoughtful design and follow the rules of database <a href="GLOSSARY.html#normalization" class="glossary-term" title="Designing a data model so that no data is replicated. We store each item of data at one place in the database and reference it elsewhere using a foreign key.">normalization</a> to make the best use of the database&apos;s capabilities. Since the primary motivation for using a database is that you have a large amount of data to deal with, it is important to model your data efficiently so your programs run as fast as possible.</p>
<h2 id="debugging">Debugging </h2>
<p>One common pattern when you are developing a Python <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> to connect to an SQLite database will be to run a Python <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> and check the results using the <a href="GLOSSARY.html#database-browser" class="glossary-term" title="A piece of software that allows you to directly connect to a database and manipulate the database directly without writing a program.">Database Browser</a> for SQLite. The browser allows you to quickly check to see if your <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> is working properly.</p>
<p>You must be careful because SQLite takes care to keep two programs from changing the same data at the same time. For example, if you open a database in the browser and make a change to the database and have not yet pressed the &quot;save&quot; button in the browser, the browser &quot;locks&quot; the database file and keeps any other <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> from accessing the file. In particular, your Python <a href="GLOSSARY.html#program" class="glossary-term" title="A set of instructions that specifies a computation.">program</a> will not be able to access the file if it is locked.</p>
<p>So a solution is to make sure to either close the <a href="GLOSSARY.html#database-browser" class="glossary-term" title="A piece of software that allows you to directly connect to a database and manipulate the database directly without writing a program.">database browser</a> or use the <strong>File</strong> menu to close the database in the browser before you attempt to access the database from Python to avoid the problem of your Python code failing because the database is locked.</p>
<hr>
<blockquote id="fn_1">
<sup>1</sup>. SQLite actually does allow some flexibility in the <a href="GLOSSARY.html#type" class="glossary-term" title="A category of values. The types we have seen so far are integers (type int), floating-point numbers (type float), and strings (type str).">type</a> of data stored in a column, but we will keep our data types strict in this chapter so the concepts apply equally to other database systems such as MySQL.<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#x21A9;</a>
</blockquote>
<blockquote id="fn_1">
<sup>1</sup>. In general, when a sentence starts with &quot;if all goes well&quot; you will find that the code needs to use try/except.<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#x21A9;</a>
</blockquote>
<p><div id="page-footer" class="localized-footer"><hr><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="Licencia de Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Python for person in everybody</span>, escrito a partir del libro <a rel="license" href="https://www.py4e.com/book" target="_blank">&apos;Python for Everybody&apos;</a> por <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"><a rel="license" href="http://www.dr-chuck.com/" target="_blank">Charles R. Severance</a></span> bajo licencia <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Reconocimiento-NoComercial-CompartirIgual 4.0 Internacional License</a>.</p>
</div></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="14-objects.html" class="navigation navigation-prev " aria-label="Previous page: 14. Objects">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="crditos.html" class="navigation navigation-next " aria-label="Next page: Créditos">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"15. Python and Databases","level":"2.15","depth":1,"next":{"title":"Créditos","level":"3.1","depth":1,"path":"crditos.md","ref":"crditos.md","articles":[]},"previous":{"title":"14. Objects","level":"2.14","depth":1,"path":"14-objects.md","ref":"14-objects.md","articles":[]},"dir":"ltr"},"config":{"plugins":["youtube","image-captions","accordion","styled-blockquotes","localized-footer","edit-link","githubcontributors","language-picker","ga"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"language-picker":{"grid-columns":3},"youtube":{},"accordion":{},"search":{},"styled-blockquotes":{},"localized-footer":{"filename":"./FOOTER.md","hline":true},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-135691041-2"},"githubcontributors":{"contributorWidth":"300px","githubOwner":"catedu","githubRepository":"python-for-person-in-everybody"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":{"en":"Edit this page","es":"Edita esta página"},"base":"https://github.com/catedu/python-for-person-in-everybody/edit/master/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"image-captions":{"caption":"Imagen - _CAPTION_","variable_name":"_pictures"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"title":"Python for person in everybody","author":"Charles R. Severance","collaborators":[{"name":"_________","edited":"_____________"}],"_pictures":[{"backlink":"01-intro.html#fig2.1.1","level":"2.1","list_caption":"Figure: Installing Python","alt":"Installing Python","nro":1,"url":"https://deleyva.gitbooks.io/automatiza-tu-aprendizaje-con-python/content/img/python-path.png","index":1,"caption_template":"Imagen - _CAPTION_","label":"Installing Python","attributes":{},"skip":false,"key":"2.1.1"},{"backlink":"01-intro.html#fig2.1.2","level":"2.1","list_caption":"Figure: Personal Digital Assistant","alt":"Personal Digital Assistant","nro":2,"url":"../img/descarga.svg","index":2,"caption_template":"Imagen - _CAPTION_","label":"Personal Digital Assistant","attributes":{},"skip":false,"key":"2.1.2"},{"backlink":"01-intro.html#fig2.1.3","level":"2.1","list_caption":"Figure: Programmers Talking to You","alt":"Programmers Talking to You","nro":3,"url":"../img/programers-talking-to-you.svg","index":3,"caption_template":"Imagen - _CAPTION_","label":"Programmers Talking to You","attributes":{},"skip":false,"key":"2.1.3"},{"backlink":"01-intro.html#fig2.1.4","level":"2.1","list_caption":"Figure: Hardware Archicture","alt":"Hardware Archicture","nro":4,"url":"../img/hardware-architecture.svg","index":4,"caption_template":"Imagen - _CAPTION_","label":"Hardware Archicture","attributes":{},"skip":false,"key":"2.1.4"},{"backlink":"01-intro.html#fig2.1.5","level":"2.1","list_caption":"Figure: Where Are you?","alt":"Where Are you?","nro":5,"url":"../img/where-r-you.svg","index":5,"caption_template":"Imagen - _CAPTION_","label":"Where Are you?","attributes":{},"skip":false,"key":"2.1.5"},{"backlink":"03-conditional.html#fig2.3.1","level":"2.3","list_caption":"Figure: If logic","alt":"If logic","nro":6,"url":"../img/if.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"If logic","attributes":{},"skip":false,"key":"2.3.1"},{"backlink":"03-conditional.html#fig2.3.2","level":"2.3","list_caption":"Figure: If-Then-Else Logic","alt":"If-Then-Else Logic","nro":7,"url":"../img/if-else.svg","index":2,"caption_template":"Imagen - _CAPTION_","label":"If-Then-Else Logic","attributes":{},"skip":false,"key":"2.3.2"},{"backlink":"03-conditional.html#fig2.3.3","level":"2.3","list_caption":"Figure: If-Then-ElseIf Logic","alt":"If-Then-ElseIf Logic","nro":8,"url":"../img/elif.svg","index":3,"caption_template":"Imagen - _CAPTION_","label":"If-Then-ElseIf Logic","attributes":{},"skip":false,"key":"2.3.3"},{"backlink":"03-conditional.html#fig2.3.4","level":"2.3","list_caption":"Figure: Nested If Statements","alt":"Nested If Statements","nro":9,"url":"../img/nested.svg","index":4,"caption_template":"Imagen - _CAPTION_","label":"Nested If Statements","attributes":{},"skip":false,"key":"2.3.4"},{"backlink":"06-strings.html#fig2.6.1","level":"2.6","list_caption":"Figure: String Indexes","alt":"String Indexes","nro":10,"url":"../img/banana.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"String Indexes","attributes":{},"skip":false,"key":"2.6.1"},{"backlink":"07-files.html#fig2.7.1","level":"2.7","list_caption":"Figure: Secondary memory","alt":"Secondary memory","nro":11,"url":"../img/seconday_memory.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"Secondary memory","attributes":{},"skip":false,"key":"2.7.1"},{"backlink":"07-files.html#fig2.7.2","level":"2.7","list_caption":"Figure: A File Handle","alt":"A File Handle","nro":12,"url":"../img/file-handle.svg","index":2,"caption_template":"Imagen - _CAPTION_","label":"A File Handle","attributes":{},"skip":false,"key":"2.7.2"},{"backlink":"08-lists.html#fig2.8.1","level":"2.8","list_caption":"Figure: Variables and Objects","alt":"Variables and Objects","nro":13,"url":"../img/variables-objects.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"Variables and Objects","attributes":{},"skip":false,"key":"2.8.1"},{"backlink":"12-network.html#fig2.12.1","level":"2.12","list_caption":"Figure: A Socket Connection","alt":"A Socket Connection","nro":14,"url":"../img/socket.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"A Socket Connection","attributes":{},"skip":false,"key":"2.12.1"},{"backlink":"13-web.html#fig2.13.1","level":"2.13","list_caption":"Figure: A Tree Representation of XML","alt":"A Tree Representation of XML","nro":15,"url":"../img/xml.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"A Tree Representation of XML","attributes":{},"skip":false,"key":"2.13.1"},{"backlink":"14-objects.html#fig2.14.1","level":"2.14","list_caption":"Figure: A program","alt":"A program","nro":16,"url":"../img/input-output.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"A program","attributes":{},"skip":false,"key":"2.14.1"},{"backlink":"14-objects.html#fig2.14.2","level":"2.14","list_caption":"Figure: A Program as Network of Objects","alt":"A Program as Network of Objects","nro":17,"url":"../img/program-as-network.svg","index":2,"caption_template":"Imagen - _CAPTION_","label":"A Program as Network of Objects","attributes":{},"skip":false,"key":"2.14.2"},{"backlink":"14-objects.html#fig2.14.3","level":"2.14","list_caption":"Figure: Ignoring Detail When Using an Object","alt":"Ignoring Detail When Using an Object","nro":18,"url":"../img/ignoring-details.svg","index":3,"caption_template":"Imagen - _CAPTION_","label":"Ignoring Detail When Using an Object","attributes":{},"skip":false,"key":"2.14.3"},{"backlink":"14-objects.html#fig2.14.4","level":"2.14","list_caption":"Figure: Ignoring Detail When Building an Object","alt":"Ignoring Detail When Building an Object","nro":19,"url":"../img/building-objects-details-ignored.svg","index":4,"caption_template":"Imagen - _CAPTION_","label":"Ignoring Detail When Building an Object","attributes":{},"skip":false,"key":"2.14.4"},{"backlink":"14-objects.html#fig2.14.5","level":"2.14","list_caption":"Figure: A Class and Two Objects","alt":"A Class and Two Objects","nro":20,"url":"../img/cookies.png","index":5,"caption_template":"Imagen - _CAPTION_","label":"A Class and Two Objects","attributes":{},"skip":false,"key":"2.14.5"},{"backlink":"15-database.html#fig2.15.1","level":"2.15","list_caption":"Figure: Relational databases","alt":"Relational databases","nro":21,"url":"../img/databases.svg","index":1,"caption_template":"Imagen - _CAPTION_","label":"Relational databases","attributes":{},"skip":false,"key":"2.15.1"},{"backlink":"15-database.html#fig2.15.2","level":"2.15","list_caption":"Figure: A Database Cursor","alt":"A Database Cursor","nro":22,"url":"../img/database-cursor.svg","index":2,"caption_template":"Imagen - _CAPTION_","label":"A Database Cursor","attributes":{},"skip":false,"key":"2.15.2"},{"backlink":"15-database.html#fig2.15.3","level":"2.15","list_caption":"Figure: Rows in a Table","alt":"Rows in a Table","nro":23,"url":"../img/rows-in-table.svg","index":3,"caption_template":"Imagen - _CAPTION_","label":"Rows in a Table","attributes":{},"skip":false,"key":"2.15.3"},{"backlink":"15-database.html#fig2.15.4","level":"2.15","list_caption":"Figure: Relationships Between Tables","alt":"Relationships Between Tables","nro":24,"url":"img/relatinos-db.png","index":4,"caption_template":"Imagen - _CAPTION_","label":"Relationships Between Tables","attributes":{},"skip":false,"key":"2.15.4"},{"backlink":"15-database.html#fig2.15.5","level":"2.15","list_caption":"Figure: Connecting Tables Using JOIN","alt":"Connecting Tables Using JOIN","nro":25,"url":"../img/connecting-tables.svg","index":5,"caption_template":"Imagen - _CAPTION_","label":"Connecting Tables Using JOIN","attributes":{},"skip":false,"key":"2.15.5"}]},"language":"en","gitbook":"*"},"file":{"path":"15-database.md","mtime":"2020-11-03T15:12:48.368Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-03T15:13:25.577Z"},"basePath":".","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-githubcontributors/contributors.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

